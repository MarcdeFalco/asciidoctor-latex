base_name = ARGV[0]
input_file = base_name + ".in"
output_file = base_name + ".out"

input = File.open(input_file, 'r') { |f| f.read }

TEX_DOLLAR_RX = /(^|\s|\()\$(.*?)\$($|\s|\)|,|\.)/
LATEX_BLOCK_RX = /\\\[*\\begin\{.*?\}.*\\end\{.*?\}\\\]/
LATEX_BLOCK_SUB = '\1'

expr = "\\\[\n\\begin\{foo\}\nho ho ho\n\\end\{bar\}\n\\\]"

output = input.gsub TEX_DOLLAR_RX, TEX_DOLLAR_SUB

File.open(output_file, 'w') {|f| f.write(output) }
